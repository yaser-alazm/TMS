# TMS System Architecture Diagram

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│  Web App (React)    Mobile App (RN)    API Clients    Admin Dashboard          │
└─────────────────────┬───────────────────────────────────────────────────────────┘
                      │ HTTPS/WebSocket
                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           API GATEWAY                                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│  Gateway Service (Port 4000)                                                    │
│  • Authentication & Authorization                                             │
│  • Rate Limiting & Validation                                                  │
│  • Request Routing & Load Balancing                                            │
│  • API Versioning                                                               │
└─────────────────────┬───────────────────────────────────────────────────────────┘
                      │ HTTP
                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        MICROSERVICES LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │   User      │  │  Vehicle    │  │    GPS      │  │  Traffic    │  │ Common  │ │
│  │  Service    │  │  Service    │  │  Service    │  │  Service    │  │ Library │ │
│  │  :4001      │  │  :4002      │  │  :4003      │  │  :4004      │  │         │ │
│  │             │  │             │  │             │  │             │  │         │ │
│  │ • Auth      │  │ • Vehicle   │  │ • Location  │  │ • Traffic   │  │ • DTOs  │ │
│  │ • Users     │  │   Mgmt      │  │   Tracking  │  │   Data      │  │ • Guards│ │
│  │ • JWT       │  │ • Ownership │  │ • History   │  │ • Routes    │  │ • Pipes │ │
│  │ • JWKS      │  │ • Status    │  │ • Geofence  │  │ • Alerts    │  │ • Utils │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────┬───────────────────────────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DATA LAYER                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │   User DB   │  │ Vehicle DB  │  │   GPS DB    │  │   Redis     │  │   S3    │ │
│  │ PostgreSQL  │  │ PostgreSQL  │  │ PostgreSQL  │  │   Cache     │  │ Storage │ │
│  │             │  │             │  │             │  │             │  │         │ │
│  │ • Users     │  │ • Vehicles  │  │ • Locations │  │ • Sessions  │  │ • Files │ │
│  │ • Auth     │  │ • Ownership │  │ • Tracking  │  │ • Cache     │  │ • Docs  │ │
│  │ • Roles     │  │ • Status    │  │ • History   │  │ • Rate Limit│  │ • Images│ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## AWS Infrastructure Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           AWS CLOUD                                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        VPC (10.0.0.0/16)                               │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                Public Subnet (10.0.1.0/24)                     │   │   │
│  │  │                                                                 │   │   │
│  │  │  ┌─────────────────────────────────────────────────────────┐   │   │   │
│  │  │  │              EC2 Instance (t3.micro)                   │   │   │   │
│  │  │  │                                                         │   │   │   │
│  │  │  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────┐ │   │   │   │
│  │  │  │  │Gateway  │ │  User   │ │Vehicle  │ │   GPS   │ │Traffic│ │   │   │   │
│  │  │  │  │:4000    │ │:4001    │ │:4002    │ │:4003    │ │:4004 │ │   │   │   │
│  │  │  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────┘ │   │   │   │
│  │  │  └─────────────────────────────────────────────────────────┘   │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                Private Subnet (10.0.2.0/24)                   │   │   │
│  │  │                                                                 │   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │   │   │
│  │  │  │   User DB   │  │ Vehicle DB  │  │   GPS DB    │  │  Redis  │ │   │   │
│  │  │  │   RDS       │  │   RDS       │  │   RDS       │  │ElastiCache│   │   │
│  │  │  │ db.t3.micro │  │ db.t3.micro │  │ db.t3.micro │  │cache.t3.micro│   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘ │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        ECR Registry                                    │   │
│  │                                                                         │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐         │   │
│  │  │Gateway  │ │  User   │ │Vehicle  │ │   GPS   │ │Traffic  │         │   │
│  │  │ Image   │ │ Image   │ │ Image   │ │ Image   │ │ Image   │         │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘         │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        S3 Storage                                      │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │              Documents & Files                                 │   │   │
│  │  │  • Vehicle Documents                                           │   │   │
│  │  │  • User Files                                                  │   │   │
│  │  │  • Reports & Exports                                           │   │   │
│  │  │  • Static Assets                                               │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow Diagrams

### User Registration Flow
```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ Client  │───▶│Gateway  │───▶│  User   │───▶│ User DB │───▶│ Response│
│         │    │:4000    │    │Service  │    │         │    │         │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
                      │              │              │
                      ▼              ▼              ▼
                ┌─────────┐    ┌─────────┐    ┌─────────┐
                │Validate │    │Hash     │    │Store    │
                │Input    │    │Password │    │User     │
                └─────────┘    └─────────┘    └─────────┘
```

### Vehicle Tracking Flow
```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ GPS     │───▶│   GPS   │───▶│ GPS DB  │───▶│ Event   │───▶│Vehicle  │
│ Device  │    │Service  │    │         │    │Publish  │    │Service  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
                      │              │              │              │
                      ▼              ▼              ▼              ▼
                ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
                │Validate │    │Store    │    │Kafka    │    │Update   │
                │Location │    │Location │    │Topic    │    │Status   │
                └─────────┘    └─────────┘    └─────────┘    └─────────┘
```

### Authentication Flow
```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ Client  │───▶│Gateway  │───▶│  User   │───▶│ User DB │───▶│ JWT     │
│         │    │:4000    │    │Service  │    │         │    │Token    │
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
                      │              │              │              │
                      ▼              ▼              ▼              ▼
                ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
                │Extract  │    │Validate │    │Check    │    │Generate │
                │Token    │    │Token    │    │User     │    │Response │
                └─────────┘    └─────────┘    └─────────┘    └─────────┘
```

## Service Dependencies

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DEPENDENCY GRAPH                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────┐                                                                   │
│  │Gateway  │◄─── All Services                                                   │
│  │:4000    │                                                                   │
│  └─────────┘                                                                   │
│       │                                                                        │
│       ▼                                                                        │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐                     │
│  │  User   │    │Vehicle  │    │   GPS   │    │Traffic  │                     │
│  │Service  │    │Service  │    │Service  │    │Service  │                     │
│  │:4001    │    │:4002    │    │:4003    │    │:4004    │                     │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘                     │
│       │              │              │              │                          │
│       ▼              ▼              ▼              ▼                          │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐                     │
│  │ User DB │    │Vehicle DB│    │ GPS DB  │    │External │                     │
│  │PostgreSQL│   │PostgreSQL│   │PostgreSQL│   │ APIs    │                     │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘                     │
│       │              │              │              │                          │
│       └──────────────┼──────────────┼──────────────┘                          │
│                      ▼              ▼                                        │
│                 ┌─────────┐    ┌─────────┐                                   │
│                 │ Redis   │    │   S3    │                                   │
│                 │ Cache   │    │Storage  │                                   │
│                 └─────────┘    └─────────┘                                   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Network Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SECURITY LAYERS                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        INTERNET                                        │   │
│  └─────────────────────┬───────────────────────────────────────────────────┘   │
│                        │ HTTPS (443)                                          │
│                        ▼                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    SECURITY GROUPS                                      │   │
│  │  • SSH (22) - Restricted IPs                                           │   │
│  │  • HTTP (80) - All                                                      │   │
│  │  • HTTPS (443) - All                                                    │   │
│  │  • API Ports (4000-4004) - All                                          │   │
│  │  • PostgreSQL (5432) - VPC Only                                         │   │
│  │  • Redis (6379) - VPC Only                                               │   │
│  └─────────────────────┬───────────────────────────────────────────────────┘   │
│                        │                                                      │
│                        ▼                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    APPLICATION SECURITY                                 │   │
│  │  • JWT Token Validation                                                 │   │
│  │  • Input Validation & Sanitization                                     │   │
│  │  • Rate Limiting                                                        │   │
│  │  • CORS Configuration                                                   │   │
│  │  • Request/Response Logging                                             │   │
│  └─────────────────────┬───────────────────────────────────────────────────┘   │
│                        │                                                      │
│                        ▼                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    DATA SECURITY                                        │   │
│  │  • Encryption at Rest (RDS, S3)                                        │   │
│  │  • Encryption in Transit (TLS/SSL)                                      │   │
│  │  • Password Hashing (bcrypt)                                             │   │
│  │  • Database Access Control                                              │   │
│  │  • Backup Encryption                                                    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           DEPLOYMENT FLOW                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐       │
│  │ Source  │───▶│ Build   │───▶│ Test    │───▶│ Package │───▶│ Deploy  │       │
│  │ Code    │    │ Docker  │    │ Suite   │    │ Images  │    │ AWS     │       │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘       │
│       │              │              │              │              │             │
│       ▼              ▼              ▼              ▼              ▼             │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐       │
│  │ Git     │    │ Docker  │    │ Jest    │    │ ECR     │    │ EC2     │       │
│  │ Repo    │    │ Build   │    │ Tests   │    │ Push    │    │ Deploy  │       │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘       │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        CI/CD PIPELINE                                   │   │
│  │                                                                         │   │
│  │  1. Code Commit → GitHub                                                │   │
│  │  2. GitHub Actions Trigger                                             │   │
│  │  3. Build Docker Images                                                 │   │
│  │  4. Run Test Suite                                                      │   │
│  │  5. Push to ECR                                                         │   │
│  │  6. Deploy to EC2                                                       │   │
│  │  7. Health Check                                                        │   │
│  │  8. Rollback if Failed                                                  │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
```

This visual representation provides a comprehensive overview of the Transportation Management System architecture, showing the relationships between components, data flow, security layers, and deployment processes.
